- Goal (incl. success criteria):
  - Deliver Lagom VPN Pro Telegram bot (@lagvpnbot) with onboarding, device setup, tariffs, profile, FAQ, referral, RU/EN, media cards, automated expiry reminders, support bot + channel integration, and confirm production readiness for real users.
- Constraints/Assumptions:
  - Keep secrets out of git; use `.env` on server.
  - Use user-provided screenshots/copy; match competitor flow (2-column buttons) but rephrase branding.
  - Payments/key issuance are placeholders until provided.
- Key decisions:
  - Aiogram v3 bot; SQLite storage at `data/bot.db`; hourly reminder loop.
  - Media assets in `assets/` and helper mapping in `src/media.py`.
  - Support bot: `@GetniusSupport_bot`, channel: `https://t.me/genialvpn`, admin ID: `5795082902`.
  - Branding defaults: `Lagom VPN Pro` and `@lagvpnbot`.
  - Manual testing now; planned payment provider: YooMoney (Ð®Money).
- State:
  - Done:
    - Added media cards (welcome/pricing/pro/referral/steps) and updated bot flows to send images.
    - Added `python-dotenv`, `src/storage.py` for reminders, admin commands (`/set_expire`, `/set_plan`).
    - Updated texts/keyboards for RU/EN, 2-column device buttons, tariffs/pro/referral flows.
    - Added support/channel buttons + handlers, support bot (`src/support_bot.py`), and updated `.env.example` + `.gitignore` (add `data/`).
    - Added support/channel images into `assets/` (support.png, channel.png).
    - Removed privacy email line from profile/support copy.
    - Added 3x-ui API client scaffolding and admin issue command (`/issue`, `/xui_inbounds`).
    - Added webhook handler and systemd unit templates for main/support/webhook services.
    - Added upsert logic for existing clients via 3x-ui API.
    - Fixed RU/EN encoding issues in texts/keyboards/support bot/webhook.
    - Added profile empty-state + clarified key copy hint.
    - Added multi-inbound support via `XUI_INBOUND_IDS` and updated XUI issue flow.
    - Added ops scripts for healthchecks and update checks + systemd timers.
    - Added strict audit file `AUDIT.md`.
    - Added profile actions (resend key, switch server via subscription, check connection).
    - Added healthcheck/updatecheck envs + XUI timeout.
    - Added support ticket IDs and DB-backed language restore.
    - Shortened onboarding and reduced duplicate messages for support/channel/tariffs.
    - Updated pricing copy: trial 7 days/25 RUB, 3m 250, 12m 900.
    - Adjusted /start flow: menu line first, welcome text includes device prompt.
    - Updated default channel link to https://t.me/genialvpn.
    - Refined trial pricing copy to clarify card verification charge.
    - Reordered tariffs flow to show PRO features before pricing block.
    - Device instructions now show setup text even without key (with pay-after note).
    - Added Happ/V2RayTUN download links in device instructions (support bot greeting kept clean).
  - Now:
    - Systemd units installed; main/support/webhook services running on server.
    - Rotate bot tokens (posted in chat) and update `.env` on server.
    - Pull latest changes on server (pricing update) and restart bot(s).
    - Configure `.env` on server with `XUI_INBOUND_IDS`, `CHECK_URL`, XUI timeout, healthcheck/updatecheck vars.
    - Replace bot media assets with new minimalistic images from `C:\Users\alien\Desktop\VPN\photovpn`.
  - Next:
    - Wire payments + auto key issuance; add runbook/tests.
- Open questions (UNCONFIRMED if needed):
  - Support bot token, support admin chat ID (if different from admin ID).
  - Final pricing, trial duration, renewal URL, YooMoney webhook format/signature.
- Working set (files/ids/commands):
  - `src/main.py`, `src/texts.py`, `src/keyboards.py`, `src/issue.py`, `src/ops/*`, `.env.example`, `deploy/systemd/*`, `AUDIT.md`
